"use strict";(self["webpackChunkdaclifyfrontend"]=self["webpackChunkdaclifyfrontend"]||[]).push([[628],{37628:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ge});var o=a(34182);const n=(0,o.createElementVNode)("div",{style:{height:"275px"}},null,-1);function s(e,t,a,s,c,i){const r=(0,o.resolveComponent)("scrolling-background"),l=(0,o.resolveComponent)("newGroup"),u=(0,o.resolveComponent)("q-page");return(0,o.openBlock)(),(0,o.createBlock)(u,{padding:"",class:"bg-white"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{class:"absolute-bottom"}),(0,o.createVNode)(l,{class:"q-mt-lg",prefill:{group_account_name:e.$route.params.newgroupname}},null,8,["prefill"]),n])),_:1})}var c=a(10741);const i={class:"scrolling-bg-container"},r=(0,o.createElementVNode)("div",{class:"sliding-background-image"},null,-1),l=[r];function u(e,t,a,n,s,c){return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,l)}const d=(0,o.defineComponent)({data(){return{}}});var m=a(74260);const p=(0,m.Z)(d,[["render",u]]),h=p,g={class:"row justify-center"},_={class:"create-group-width"},f={class:"q-mb-md text-grey-5 text-h6 text-weight-light"},y={key:0,class:"row justify-between"},b=(0,o.createElementVNode)("div",null,"GROUP NAME",-1),w={key:1,class:"row justify-between"},v=(0,o.createElementVNode)("div",null,"CREATE ACCOUNT",-1),N={key:2,class:"row justify-between"},x=(0,o.createElementVNode)("div",null,"CREATING",-1),C={class:"text-uppercase text-primary"},k={class:"rounded-borders overflow-hidden"},V={key:0,class:"text-grey-8 row"},A=(0,o.createElementVNode)("span",null,"Account name available!",-1),E=[A],B={key:1},q={class:"column justify-center items-center q-mt-lg"},R={key:0,class:"q-mt-sm"},$=(0,o.createTextVNode)(" This group isn't activated yet. Proceed to activation by clicking the button. "),D={class:"row justify-begin items-center text-black"},T={class:"text-uppercase"},S=(0,o.createTextVNode)(" Edit Group Name. "),P={class:"text-grey-6"},G={class:"column justify-center items-center q-mt-md"},Z={class:"column items-center full-height text-grey-6 q-pt-md"},z=(0,o.createTextVNode)(" Account created "),j={class:"column items-center full-height text-grey-6 q-pt-md"},Q=(0,o.createElementVNode)("div",{class:"q-mt-md"},"Waiting for Signature",-1),F={class:"column items-center full-height text-grey-6 q-pt-md"},H=(0,o.createElementVNode)("div",{class:"q-mt-xs"},"Group created successful",-1);function W(e,t,a,n,s,c){const i=(0,o.resolveComponent)("q-icon"),r=(0,o.resolveComponent)("q-input"),l=(0,o.resolveComponent)("q-btn"),u=(0,o.resolveComponent)("q-tooltip"),d=(0,o.resolveComponent)("q-carousel-slide"),m=(0,o.resolveComponent)("q-spinner"),p=(0,o.resolveComponent)("q-carousel"),h=(0,o.resolveComponent)("wasmCompiler");return(0,o.openBlock)(),(0,o.createElementBlock)("div",g,[(0,o.createElementVNode)("div",_,[(0,o.createElementVNode)("div",f,["request_account_name"===e.step?((0,o.openBlock)(),(0,o.createElementBlock)("div",y,[b,(0,o.createElementVNode)("div",null,"1/"+(0,o.toDisplayString)(e.number_of_steps),1)])):(0,o.createCommentVNode)("",!0),"create_account"===e.step?((0,o.openBlock)(),(0,o.createElementBlock)("div",w,[v,(0,o.createElementVNode)("div",null,"2/"+(0,o.toDisplayString)(e.number_of_steps),1)])):"request_signature"===e.step?((0,o.openBlock)(),(0,o.createElementBlock)("div",N,[x,(0,o.createElementVNode)("div",C,(0,o.toDisplayString)(e.new_group_account_name),1)])):(0,o.createCommentVNode)("",!0)]),(0,o.createVNode)(p,{modelValue:e.step,"onUpdate:modelValue":t[5]||(t[5]=t=>e.step=t),"keep-alive":"",navigation:!1,"transition-prev":"scale","transition-next":"scale",swipeable:!1,animated:"","control-color":"primary",padding:!1,arrows:!1,height:"250px",class:"bg-transparent"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{name:"request_account_name",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",null,[(0,o.createElementVNode)("div",k,[(0,o.createVNode)(r,{dark:!1,ref:"accountinput",autocomplete:"off",outlined:"","no-error-icon":"",counter:"",maxlength:"12",color:"accent","bg-color":"white",modelValue:e.new_group_account_name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.new_group_account_name=t),placeholder:"Choose new group name",rules:[e=>!!e||"* Required",e.isValidAccountName,e=>12==e.length||"Group name must be min 12  chars.",e.isavailableAccountNameWrapper],onInput:t[1]||(t[1]=t=>e.account_name_validated=!1)},{prepend:(0,o.withCtx)((()=>[(0,o.createVNode)(i,{name:"people"})])),append:(0,o.withCtx)((()=>[e.account_name_validated?((0,o.openBlock)(),(0,o.createBlock)(i,{key:0,name:"check",color:"positive"})):(0,o.createCommentVNode)("",!0)])),hint:(0,o.withCtx)((()=>[e.account_name_validated?((0,o.openBlock)(),(0,o.createElementBlock)("span",V,E)):((0,o.openBlock)(),(0,o.createElementBlock)("span",B,"12 char account name"))])),_:1},8,["modelValue","rules"])]),(0,o.createElementVNode)("div",q,[(0,o.createVNode)(l,{color:"primary",label:"next",style:{width:"150px"},disabled:!e.account_name_validated,onClick:t[2]||(t[2]=t=>e.next(""))},null,8,["disabled"]),e.groups_by_creator.length?((0,o.openBlock)(),(0,o.createElementBlock)("div",R,[(0,o.createVNode)(o.TransitionGroup,{appear:"","enter-active-class":"animated zoomIn","leave-active-class":"animated zoomOut",mode:"out-in",class:"column q-gutter-sm",tag:"div"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.groups_by_creator.filter((e=>0===e.state)),(t=>((0,o.openBlock)(),(0,o.createBlock)(l,{icon:"mdi-alert",label:t.groupname,key:t.groupname,color:"secondary",onClick:a=>e.next(t.groupname)},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{class:"bg-secondary",delay:500},{default:(0,o.withCtx)((()=>[$])),_:1})])),_:2},1032,["label","onClick"])))),128))])),_:1})])):(0,o.createCommentVNode)("",!0)])])])),_:1}),(0,o.createVNode)(d,{name:"create_account",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",D,[(0,o.createElementVNode)("span",T,(0,o.toDisplayString)(e.new_group_account_name),1),(0,o.createVNode)(l,{icon:"edit",round:"",flat:"",size:"sm",onClick:t[3]||(t[3]=t=>e.step="request_account_name")},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{delay:300,anchor:"center right",self:"center left",offset:[10,0]},{default:(0,o.withCtx)((()=>[S])),_:1})])),_:1})]),(0,o.createElementVNode)("div",P,[(0,o.createElementVNode)("div",null," Account will be created. Estimated RAM cost is "+(0,o.toDisplayString)(e.getResourceEstimation),1)]),(0,o.createElementVNode)("div",G,[(0,o.createVNode)(l,{color:"primary",label:"create",style:{width:"150px"},disabled:!e.account_name_validated,onClick:e.createGroup},null,8,["disabled","onClick"])])])),_:1}),(0,o.createVNode)(d,{name:"request_activation",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",Z,[z,(0,o.createVNode)(l,{color:"primary",label:"activate",style:{width:"150px"},disabled:!e.account_name_validated,onClick:e.activateGroup},null,8,["disabled","onClick"])])])),_:1}),(0,o.createVNode)(d,{name:"request_signature",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",j,[(0,o.createVNode)(m,{color:"primary",size:"40px",onClick:t[4]||(t[4]=t=>e.step="request_account_name"),class:"cursor-pointer"}),Q])])),_:1}),(0,o.createVNode)(d,{name:"group_created",class:"no-padding"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",F,[(0,o.createVNode)(i,{color:"primary",size:"40px",name:"check"}),H,(0,o.createVNode)(l,{label:"visit group",color:"secondary",class:"q-mt-md",to:`./manage/${e.new_group_account_name}`},null,8,["to"])])])),_:1})])),_:1},8,["modelValue"])]),(0,o.createVNode)(h,{ref:"wasm_compiler"},null,512)])}a(10071);function O(e,t,a,n,s,c){(0,o.resolveComponent)("q-icon"),(0,o.resolveComponent)("q-btn");return(0,o.createCommentVNode)("",!0)}a(76105),a(15123),a(98685),a(12396);var I=a(16336),U=a(40019),L=a(14244)["Buffer"];const M=(0,o.defineComponent)({name:"wasmCompiler",props:{asbuffer:{type:Boolean,default:!1},label:{type:String,default:"Select File"}},data(){return{filename:"",filesize:""}},methods:{async loadRemoteWasm(e){e=e+"?t="+(new Date).getTime();let t=await this.$axios.get(e,{responseType:"arraybuffer"}),a=(0,I.JQ)(new Uint8Array(t.data,0));return U.log("calculated code_hash",a),t={wasm:this.buf2hex(t.data),code_hash:a},t},async loadRemoteAbi(e){e=e+"?t="+(new Date).getTime();let t=await this.$axios.get(e,{responseType:"text",transformResponse:[e=>e]});return t=await this.parseAbi(t.data),t},async handleInput(){let e=await this._readLocalFile(this.asbuffer);e=this.asbuffer?this.buf2hex(e):await this.parseAbi(e),U.log(e),this.$emit("input",e)},async _readLocalFile(e=!1){var t=this.$refs.myfileinput.files[0];return this.filename=t.name,this.filesize=`${(t.size/1024).toFixed(2)}KB`,new Promise(((a,o)=>{var n=new FileReader;n.onload=function(e){return a(n.result)},e?n.readAsArrayBuffer(t):n.readAsText(t,"utf8")}))},async parseAbi(e){const t=this.$eos.Serialize,a=new t.SerialBuffer({textEncoder:new TextEncoder,textDecoder:new TextDecoder});let o=JSON.parse(e);const n=await this.$eos.api.abiTypes.get("abi_def");return o=n.fields.reduce(((e,{name:t})=>Object.assign(e,{[t]:e[t]||[]})),o),n.serialize(a,o),L.from(a.asUint8Array()).toString("hex")},buf2hex(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}}});var K=a(24554),J=a(2165),X=a(7518),Y=a.n(X);const ee=(0,m.Z)(M,[["render",O]]),te=ee;Y()(M,"components",{QIcon:K.Z,QBtn:J.Z});var ae=a(47592),oe=a(40019);const ne=(0,o.defineComponent)({name:"newGroup",components:{wasmCompiler:te},props:{prefill:{type:Object,default:()=>({group_account_name:""})}},data(){return{number_of_steps:3,step:"request_account_name",new_group_account_name:"",account_name_validated:!1,voice_only:!1,wasmhex:"",abihex:"",groups_by_creator:[],required_bytes:16e5}},computed:{...(0,c.Se)({getAccountName:"ual/getAccountName",getAppConfig:"app/getAppConfig",getHubDeposits:"user/getHubDeposits",getRamPricePerByte:"app/getRamPricePerByte"}),getResourceEstimation(){if(this.getRamPricePerByte)return(this.getRamPricePerByte*this.required_bytes+2).toFixed(4)+` ${this.getAppConfig.system_token.symbol}`},has_enough_deposits(){let e=!1;if(this.getResourceEstimation&&this.getHubDeposits.length){let e=this.getHubDeposits.find((e=>e.symbol==this.getAppConfig.system_token.symbol)).quantity;if(e)return parseFloat(this.getResourceEstimation)<=parseFloat(e)}return e}},async mounted(){this.$store.dispatch("app/fetchRamPricePerByte",{vm:this}),await this.get_wasm_and_abi_from_github(),this.prefill.group_account_name&&(this.new_group_account_name=this.prefill.group_account_name)},watch:{new_group_account_name:function(){oe.log(this.$refs.accountinput.hasError)},getAccountName:{immediate:!0,handler:function(e,t){this.getAccountName&&this.getGroupsByCreator()}}},methods:{isValidAccountName:ae.ZF,isAvailableAccountName:ae.Kx,async isavailableAccountNameWrapper(e){const t=await(0,ae.Kx)({v:e,vm:this});return oe.log(t),!0===t?(this.account_name_validated=!0,!0):(this.account_name_validated=!1,t)},async activateGroup(){this.deploycontract(this.new_group_account_name)},async createGroup(){if(!this.has_enough_deposits)return void this.openHubWallet();await this.$store.dispatch("app/fetchRamPricePerByte"),this.step="request_signature";let e={account:this.getAppConfig.groups_contract,name:"creategroup",data:{groupname:this.new_group_account_name,creator:this.getAccountName,resource_estimation:this.getResourceEstimation}},t=await this.$store.dispatch("ual/transact",{actions:[e],disable_signing_overlay:!0});if(setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),2e3),!t||!t.trxid)return this.step="create_account",!1;this.step="request_activation"},async deploycontract(e){this.step="request_signature";let t={account:"eosio",name:"setcode",data:{account:e,vmtype:0,vmversion:0,code:this.wasmhex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},a={account:"eosio",name:"setabi",data:{account:e,abi:this.abihex},authorization:[{actor:this.getAccountName,permission:"active"},{actor:e,permission:"active"}]},o={account:this.getAppConfig.groups_contract,name:"activate",data:{groupname:e,creator:this.getAccountName}},n=await this.$store.dispatch("ual/transact",{actions:[a,t,o],disable_signing_overlay:!0});return setTimeout((()=>{this.$store.dispatch("user/fetchHubDeposits",{accountname:this.getAccountName,vm:this})}),1e3),n&&n.trxid?(this.step="group_created",!0):(this.step="request_activation",!1)},openHubWallet(){let e=`You don't have enough EOS/TLOS/WAX deposits to pay for RAM. Daclify calculated you need a minimum of ${this.getResourceEstimation} to deploy the daclify core contract. Excess deposits will be used to buy extra RAM. Daclify takes no fees.`;this.emitter.emit("showHubDeposits",e)},async next(e=""){""!=e?(this.step="request_activation",this.account_name_validated=!0,this.new_group_account_name=e):(this.step="create_account",this.has_enough_deposits||this.openHubWallet())},async get_wasm_and_abi_from_github(){oe.log("retrieving code from github");let e=await this.$refs.wasm_compiler.loadRemoteWasm("https://raw.githubusercontent.com/Daclify/daclifycore/master/daclifycore.wasm"),t=await this.$refs.wasm_compiler.loadRemoteAbi("https://raw.githubusercontent.com/Daclify/daclifycore/master/daclifycore.abi");this.wasmhex=e.wasm,this.abihex=t},async get_wasm_and_abi_from_block(e){let t=[];t.push(this.$eos.api.rpc.get_block(e.wasm[0])),e.wasm[0]!=e.abi[0]&&t.push(this.$eos.api.rpc.get_block(e.abi[0]));let[a,o]=await Promise.all(t);o=o||a;let n=a.transactions.find((t=>t.trx.id==e.wasm[1])).trx.transaction.actions.find((e=>"setcode"==e.name)).data.code,s=o.transactions.find((t=>t.trx.id==e.abi[1])).trx.transaction.actions.find((e=>"setabi"==e.name)).data.abi;this.wasmhex=n,this.abihex=s},async getGroupsByCreator(){let e=await this.$eos.api.rpc.get_table_rows({json:!0,code:this.getAppConfig.groups_contract,scope:this.getAppConfig.groups_contract,table:"groups",key_type:"name",index_position:3,lower_bound:this.getAccountName,upper_bound:this.getAccountName,limit:-1});e=e&&e.rows.length&&e.rows[0].creator==this.getAccountName?e.rows:[],oe.log("fetched groups by creator",e),this.groups_by_creator=e}}});var se=a(31277),ce=a(34593),ie=a(64689),re=a(5363),le=a(6833);const ue=(0,m.Z)(ne,[["render",W]]),de=ue;Y()(ne,"components",{QCarousel:se.Z,QCarouselSlide:ce.Z,QInput:ie.Z,QIcon:K.Z,QBtn:J.Z,QTooltip:re.Z,QSpinner:le.Z});const me=(0,o.defineComponent)({name:"create",components:{newGroup:de,scrollingBackground:h},data(){return{}},computed:{...(0,c.Se)({getAccountName:"ual/getAccountName"})},methods:{},watch:{}});var pe=a(24379);const he=(0,m.Z)(me,[["render",s]]),ge=he;Y()(me,"components",{QPage:pe.Z})}}]);